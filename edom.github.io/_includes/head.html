<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">

  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }}" href="{{ "/feed.xml" | relative_url }}">

  {% if page.opengraph %}
  {% if page.opengraph.title %}
  <meta property="og:title" content="{{ page.opengraph.title }}">
  {% endif %}
  {% if page.opengraph.description %}
  <meta property="og:description" content="{{ page.opengraph.description }}">
  {% endif %}
  {% endif %}

  {% if jekyll.environment == 'production' and site.google_analytics %}
  {% include google-analytics.html %}
  {% endif %}

  {% if page.mathjax %}
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    jax: ["input/TeX","input/MathML","input/AsciiMath",
{% if page.draft %}
    "output/PreviewHTML"
{% else %}
    "output/CommonHTML"
{% endif %}
    ],
    extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "a11y/accessibility-menu.js"],
    TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
        , equationNumbers: {
            autoNumber: "AMS"
        }
    },
    "CommonHTML": {
        scale: 100
    },
    "fast-preview": {
        disabled: true,
    }
});
  </script>
  {% if page.draft %}
<style>
/* PreviewHTML scale doesn't work */
.MathJax_PHTML { font-size: 125%; }
</style>
  {% endif %}
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js" async></script>
  {% endif %}
    <script>
        // Help the reader estimate how much time the reading is going to take.
        // Show word count and reading time estimation in TOC entry.
        //
        // TOC = table of contents
        document.addEventListener("DOMContentLoaded", function () {
            function count_word (string) {
                return string.trim().split(/\s+/).length;
            }
            function show_quantity (count, singular) {
                let plural = singular + "s"; // For this script only.
                return count + " " + ((count == 1) ? singular : plural);
            }
            // We violate the HTML specification.
            // The page may have several elements with the same ID.
            // We assume that Org HTML Export generates a DIV element with ID "table-of-contents".
            // We assume that Jekyll Markdown-to-HTML generates a UL element with ID "markdown-toc".
            // This only works for Org HTML Export's TOC.
            let toc_entries = document.querySelectorAll("#table-of-contents a");
            toc_entries.forEach((toc_entry_a) => {
                let href = toc_entry_a.getAttribute("href"); // We assume that this is a string like "#org0123456".
                let h_elem = document.querySelector(href); // We assume that this is the h1/h2/h3 element referred by the TOC entry.
                if (h_elem === null) { // We assume that this is impossible.
                    console.log("toc_generate_estimate: Impossible: " + href + " does not refer to anything");
                    return;
                }
                let section = h_elem.parentNode;
                let word_count = count_word(section.textContent);
                // We assume that readers read this many words per minute with 100% comprehension.
                // This assumption may not hold for dense texts such as philosophy and mathematics.
                let wpm_assumption = 200;
                let minute_estimate = Math.ceil(word_count / wpm_assumption);
                let length_indicator = (function () {
                    let e = document.createElement("span");
                    e.className = "toc_entry__length_indicator";
                    e.textContent = " (" + show_quantity(word_count, "word") + " ~ " + show_quantity(minute_estimate, "minute") + ")";
                    return e;
                })();
                toc_entry_a.parentNode.insertBefore(length_indicator, toc_entry_a.nextSibling);
            });
        });
    </script>
</head>
